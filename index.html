<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllAddIn99</title>
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
     <link rel="stylesheet" href="style.css">
     <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #status {
            margin-top: 20px;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #videoPlayer {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>AllAddIn99</h1>
    
<div class="buttons-container">
    <div class="left-section">
    <input type="file" id="fileInput">
    <button onclick="shareFile()">Compartir archivo</button>

</div>
    <div class="right-section">


    <input type="text" id="torrentId" placeholder="Magnet link o archivo .torrent">
    <button onclick="downloadTorrent()">Descargar</button>
</div>
</div>

    <br><br>
    <!--<video id="videoPlayer" controls></video>-->
    <div id="status"></div>

    <script>
        // Configuración del cliente WebTorrent con DHT habilitado
        const client = new WebTorrent({
            dht: true,   // Habilitar DHT para descentralización
            tracker: true // Habilitar el uso de trackers
        });

        // Compartir archivo
        function shareFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                client.seed(file, (torrent) => {
                    const magnetURI = torrent.magnetURI;
                    document.getElementById('status').innerHTML = 'Archivo compartido: <a href="' + magnetURI + '">' + magnetURI + '</a>';
                    console.log('Magnet URI:', magnetURI);
                }).on('error', (err) => {
                    console.error('Error al compartir archivo:', err);
                    document.getElementById('status').innerHTML = 'Error al compartir archivo. Revisa la consola para más detalles.';
                });
            } else {
                alert('Por favor, selecciona un archivo.');
            }
        }

        // Descargar torrent
        function downloadTorrent() {
            const torrentId = document.getElementById('torrentId').value;

            if (torrentId) {
                client.add(torrentId, (torrent) => {
                    torrent.files.forEach((file) => {
                        if (file.name.endsWith('.mp4') || file.name.endsWith('.webm')) {
                            file.renderTo('video#videoPlayer');
                        } else {
                            file.getBlobURL((err, url) => {
                                if (err) {
                                    console.error('Error al obtener URL del blob:', err);
                                    document.getElementById('status').innerHTML = 'Error al obtener URL del blob. Revisa la consola para más detalles.';
                                } else {
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = file.name;
                                    a.textContent = 'Descargar ' + file.name;
                                    document.body.appendChild(a);
                                    document.body.appendChild(document.createElement('br'));
                                }
                            });
                        }
                    });
                }).on('error', (err) => {
                    console.error('Error al descargar torrent:', err);
                    document.getElementById('status').innerHTML = 'Error al descargar torrent. Revisa la consola para más detalles.';
                });
            } else {
                alert('Por favor, introduce un enlace Magnet o un archivo .torrent.');
            }
        }
    </script>
</body>
</html>
