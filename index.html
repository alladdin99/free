<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllAddIn99</title>
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>AllAddIn99</h1>

    <div class="main-container">
        <!-- Sección de Subida -->
        <div class="section upload">
            <input type="file" id="fileInput">
            <button onclick="shareFile()">Subir archivo</button>
        </div>

        <!-- Sección de Descarga -->
        <div class="section download">
            <input type="text" id="torrentId" placeholder="Enlace Magnet o archivo .torrent">
            <button onclick="downloadTorrent()">Descargar</button>
        </div>
    </div>

    <!-- Mensaje de Estado -->
    <div id="status" class="status-message"></div>

    <footer>
        © 2024 AllAddIn99
    </footer>

    <script>
        // Verifica que WebTorrent esté disponible
        if (typeof WebTorrent === 'undefined') {
            console.error('WebTorrent no está disponible. Asegúrate de que el script se cargue correctamente.');
        } else {
            const client = new WebTorrent();

            // Compartir archivo
            function shareFile() {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];

                if (file) {
                    client.seed(file, (torrent) => {
                        const magnetURI = torrent.magnetURI;
                        document.getElementById('status').innerHTML = 'Archivo compartido: <a href="' + magnetURI + '">' + magnetURI + '</a>';
                        console.log('Magnet URI:', magnetURI);
                    });
                } else {
                    alert('Por favor, selecciona un archivo.');
                }
            }

            // Descargar torrent
            function downloadTorrent() {
                const torrentId = document.getElementById('torrentId').value;

                if (torrentId) {
                    client.add(torrentId, (torrent) => {
                        torrent.files.forEach((file) => {
                            file.getBlobURL((err, url) => {
                                if (err) {
                                    console.error('Error al obtener Blob URL:', err);
                                    document.getElementById('status').innerText = 'Error al obtener el archivo.';
                                    return;
                                }
                                const a = document.createElement('a');
                                a.href = url;
                                a.download = file.name;
                                a.textContent = 'Descargar ' + file.name;
                                document.body.appendChild(a);
                                document.body.appendChild(document.createElement('br'));
                            });
                        });
                    }, (err) => {
                        console.error('Error al agregar el torrent:', err);
                        document.getElementById('status').innerText = 'Error al agregar el torrent.';
                    });
                } else {
                    alert('Por favor, introduce un enlace Magnet o un archivo .torrent.');
                }
            }
        }
    </script>
</body>
</html>
