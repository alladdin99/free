<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllAddIn99</title>
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>游닋 AllAddIn99 游닌</h1>

       <div class="description-container">
        <p class="description">AllAddIn99 es una plataforma r치pida y segura para compartir archivos de un lugar a otro en cuesti칩n de segundos.</p>

    <p class="description">Comparte tus archivos sin complicaciones, utilizando tecnolog칤a descentralizada para garantizar la eficiencia y privacidad.</p>
        </div>
    
    <div class="main-container">
        <!-- Secci칩n de Subida -->
        <div class="section upload">
            <input type="file" id="fileInput" class="file-input" onchange="updateFileName()">
            <label for="fileInput" class="file-label">Examinar</label>
            <button onclick="shareFile()">游닋 Compartir archivo</button>
            <p id="fileName" class="file-name"></p> <!-- Elemento para mostrar el nombre del archivo -->
        </div>
        
        <!-- Secci칩n de Descarga -->
        <div class="section download">
            <input type="text" id="torrentId" placeholder="Magnet link o archivo .torrent">
            <button onclick="downloadTorrent()">游닌 Descargar</button>
        </div>
    </div>

    <br><br>
    <!--<video id="videoPlayer" controls></video>-->
    <div class="status-container">
        <div id="status"></div>
        <button class="copy-button" onclick="copyToClipboard()">游댕 Copiar enlace</button>
    </div>

     <!-- Contenedor de Explicaci칩n -->
    <div class="instructions-container">
        <h2>Explicaci칩n de uso:</h2>
        <p><strong>Subir archivo:</strong> Selecciona el archivo que deseas compartir haciendo clic en "Examinar" y luego en "Compartir archivo". Esto generar치 un enlace encriptado que podr치s copiar.</p>
        <p><strong>Compartir enlace:</strong> Copia el enlace generado y comp치rtelo con la persona que deseas enviarle el archivo.</p>
        <p><strong>Descargar archivo:</strong> La persona que recibe el enlace solo necesita pegarlo en el campo de descarga y hacer clic en "Descargar". El sistema desencriptar치 autom치ticamente el enlace y comenzar치 la descarga del archivo.</p>
        <p>춰As칤 de sencillo!</p>
    </div>

    <script>
        // Configuraci칩n del cliente WebTorrent con DHT habilitado
        const client = new WebTorrent({
            dht: true,   // Habilitar DHT para descentralizaci칩n
            tracker: true // Habilitar el uso de trackers
        });

        // Clave de encriptaci칩n (debe ser segura en producci칩n)
        const encryptionKey = 'P@ssw0rd!2024$SecureKey';

        // Funci칩n para encriptar un texto
        function encrypt(text, key) {
            return CryptoJS.AES.encrypt(text, key).toString();
        }

        // Funci칩n para desencriptar un texto
        function decrypt(text, key) {
            const bytes = CryptoJS.AES.decrypt(text, key);
            return bytes.toString(CryptoJS.enc.Utf8);
        }

        // Compartir archivo
        function shareFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                client.seed(file, (torrent) => {
                    const magnetURI = torrent.magnetURI;

                    // Encriptar el enlace magn칠tico
                    const encryptedMagnetURI = encrypt(magnetURI, encryptionKey);

                    // Mostrar el enlace acortado (en realidad, solo se muestra el enlace encriptado)
                    document.getElementById('status').innerHTML = 'Archivo compartido: <a href="#" onclick="return false;">' + encryptedMagnetURI + '</a>';
                    console.log('Magnet URI encriptado:', encryptedMagnetURI);
                    document.getElementById('copyButton').style.display = 'inline-block'; // Mostrar el bot칩n
                }).on('error', (err) => {
                    console.error('Error al compartir archivo:', err);
                    document.getElementById('status').innerHTML = 'Error al compartir archivo. Revisa la consola para m치s detalles.';
                });
            } else {
                alert('Por favor, selecciona un archivo.');
            }
        }

        // Descargar torrent
        function downloadTorrent() {
            const torrentId = document.getElementById('torrentId').value;

            if (torrentId) {
                try {
                    // Desencriptar el enlace magn칠tico
                    const decryptedMagnetURI = decrypt(torrentId, encryptionKey);

                    client.add(decryptedMagnetURI, (torrent) => {
                        torrent.files.forEach((file) => {
                            if (file.name.endsWith('.mp4') || file.name.endsWith('.webm')) {
                                file.renderTo('video#videoPlayer');
                            } else {
                                file.getBlobURL((err, url) => {
                                    if (err) {
                                        console.error('Error al obtener URL del blob:', err);
                                        document.getElementById('status').innerHTML = 'Error al obtener URL del blob. Revisa la consola para m치s detalles.';
                                    } else {
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = file.name;
                                        a.textContent = 'Descargar ' + file.name;
                                        document.body.appendChild(a);
                                        document.body.appendChild(document.createElement('br'));
                                    }
                                });
                            }
                        });
                    }).on('error', (err) => {
                        console.error('Error al descargar torrent:', err);
                        document.getElementById('status').innerHTML = 'Error al descargar torrent. Revisa la consola para m치s detalles.';
                    });
                } catch (err) {
                    console.error('Error al desencriptar el enlace:', err);
                    alert('El enlace es inv치lido o no se pudo desencriptar.');
                }
            } else {
                alert('Por favor, introduce un enlace Magnet o un archivo .torrent.');
            }
        }

        function copyToClipboard() {
            const statusElement = document.getElementById('status');
            const link = statusElement.querySelector('a');
            if (link) {
                navigator.clipboard.writeText(link.textContent).then(() => {
                    alert('Enlace copiado al portapapeles');
                }).catch(err => {
                    console.error('Error al copiar enlace: ', err);
                });
            } else {
                alert('No hay ning칰n enlace para copiar.');
            }
        }

        function updateFileName() {
            const fileInput = document.getElementById('fileInput');
            const fileNameElement = document.getElementById('fileName');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileNameElement.textContent = `Archivo seleccionado: ${file.name}`;
            } else {
                fileNameElement.textContent = '';
            }
        }
    </script>

    <footer>
        춸 2024 AllAddIn99
    </footer>
</body>
</html>
